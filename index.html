<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noindex, nofollow">
    <title>Password Protected Page</title>
    <style>
        html, body {
            margin: 0;
            width: 100%;
            height: 100%;
            font-family: Arial, Helvetica, sans-serif;
        }
        #dialogText {
            color: white;
            background-color: #333333;
        }
        
        #dialogWrap {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: table;
            background-color: #EEEEEE;
        }
        
        #dialogWrapCell {
            display: table-cell;
            text-align: center;
            vertical-align: middle;
        }
        
        #mainDialog {
            max-width: 400px;
            margin: 5px;
            border: solid #AAAAAA 1px;
            border-radius: 10px;
            box-shadow: 3px 3px 5px 3px #AAAAAA;
            margin-left: auto;
            margin-right: auto;
            background-color: #FFFFFF;
            overflow: hidden;
            text-align: left;
        }
        #mainDialog > * {
            padding: 10px 30px;
        }
        #passArea {
            padding: 20px 30px;
            background-color: white;
        }
        #passArea > * {
            margin: 5px auto;
        }
        #pass {
            width: 100%;
            height: 40px;
            font-size: 30px;
        }
        
        #messageWrapper {
            float: left;
            vertical-align: middle;
            line-height: 30px;
        }
        
        .notifyText {
            display: none;
        }
        
        #invalidPass {
            color: red;
        }
        
        #success {
            color: green;
        }
        
        #submitPass {
            font-size: 20px;
            border-radius: 5px;
            background-color: #E7E7E7;
            border: solid gray 1px;
            float: right;
            cursor: pointer;
        }
        #contentFrame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        #attribution {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: center;
            padding: 10px;
            font-weight: bold;
            font-size: 0.8em;
        }
        #attribution, #attribution a {
            color: #999;
        }
        .error {
            display: none;
            color: red;
        }
    </style>
  </head>
  <body>
    <iframe id="contentFrame" frameBorder="0" allowfullscreen></iframe>
    <div id="dialogWrap">
        <div id="dialogWrapCell">
            <div id="mainDialog">
                <div id="dialogText">This page is password protected.</div>
                <div id="passArea">
                    <p id="passwordPrompt">Password</p>
                    <input id="pass" type="password" name="pass" autofocus>
                    <div>
                        <span id="messageWrapper">
                            <span id="invalidPass" class="error">Sorry, please try again.</span>
                            <span id="trycatcherror" class="error">Sorry, something went wrong.</span>
                            <span id="success" class="notifyText">Success!</span>
                            &nbsp;
                        </span>
                        <button id="submitPass" type="button">Submit</button>
                        <div style="clear: both;"></div>
                    </div>
                </div>
                <div id="securecontext" class="error">
                    <p>
                        Sorry, but password protection only works over a secure connection. Please load this page via HTTPS.
                    </p>
                </div>
                <div id="nocrypto" class="error">
                    <p>
                        Your web browser appears to be outdated. Please visit this page using a modern browser.
                    </p>
                </div>
            </div>
        </div>
    </div>
    <div id="attribution">
        Protected by <a href="https://www.maxlaumeister.com/pagecrypt/">PageCrypt</a>
    </div>
    <script>
    (function() {

        var pl = "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";
        
        var submitPass = document.getElementById('submitPass');
        var passEl = document.getElementById('pass');
        var invalidPassEl = document.getElementById('invalidPass');
        var trycatcherror = document.getElementById('trycatcherror');
        var successEl = document.getElementById('success');
        var contentFrame = document.getElementById('contentFrame');
        
        // Sanity checks

        if (pl === "") {
            submitPass.disabled = true;
            passEl.disabled = true;
            alert("This page is meant to be used with the encryption tool. It doesn't work standalone.");
            return;
        }

        if (!isSecureContext) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#securecontext").style.display = "block";
            return;
        }

        if (!crypto.subtle) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#nocrypto").style.display = "block";
            return;
        }
        
        function str2ab(str) {
            var ustr = atob(str);
            var buf = new ArrayBuffer(ustr.length);
            var bufView = new Uint8Array(buf);
            for (var i=0, strLen=ustr.length; i < strLen; i++) {
                bufView[i] = ustr.charCodeAt(i);
            }
            return bufView;
        }

        async function deriveKey(salt, password) {
            const encoder = new TextEncoder()
            const baseKey = await crypto.subtle.importKey(
                'raw',
                encoder.encode(password),
                'PBKDF2',
                false,
                ['deriveKey'],
            )
            return await crypto.subtle.deriveKey(
                { name: 'PBKDF2', salt, iterations: 100000, hash: 'SHA-256' },
                baseKey,
                { name: 'AES-GCM', length: 256 },
                true,
                ['decrypt'],
            )
        }
        
        async function doSubmit(evt) {
            submitPass.disabled = true;
            passEl.disabled = true;

            let iv, ciphertext, key;
            
            try {
                var unencodedPl = str2ab(pl);

                const salt = unencodedPl.slice(0, 32)
                iv = unencodedPl.slice(32, 32 + 16)
                ciphertext = unencodedPl.slice(32 + 16)

                key = await deriveKey(salt, passEl.value);
            } catch (e) {
                trycatcherror.style.display = "inline";
                console.error(e);
                return;
            }

            try {
                const decryptedArray = new Uint8Array(
                    await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, ciphertext)
                );

                let decrypted = new TextDecoder().decode(decryptedArray);

                if (decrypted === "") throw "No data returned";

                const basestr = '<base href="." target="_top">';
                const anchorfixstr = `
                    <script>
                        Array.from(document.links).forEach((anchor) => {
                            const href = anchor.getAttribute("href");
                            if (href.startsWith("#")) {
                                anchor.addEventListener("click", function(e) {
                                    e.preventDefault();
                                    const targetId = this.getAttribute("href").substring(1);
                                    const targetEl = document.getElementById(targetId);
                                    targetEl.scrollIntoView();
                                });
                            }
                        });
                    <\/script>
                `;
                
                // Set default iframe link targets to _top so all links break out of the iframe
                if (decrypted.includes("<head>")) decrypted = decrypted.replace("<head>", "<head>" + basestr);
                else if (decrypted.includes("<!DOCTYPE html>")) decrypted = decrypted.replace("<!DOCTYPE html>", "<!DOCTYPE html>" + basestr);
                else decrypted = basestr + decrypted;

                // Fix fragment links
                if (decrypted.includes("</body>")) decrypted = decrypted.replace("</body>", anchorfixstr + '</body>');
                else if (decrypted.includes("</html>")) decrypted = decrypted.replace("</html>", anchorfixstr + '</html>');
                else decrypted = decrypted + anchorfixstr;
                
                contentFrame.srcdoc = decrypted;
                
                successEl.style.display = "inline";
                setTimeout(function() {
                    dialogWrap.style.display = "none";
                }, 1000);
            } catch (e) {
                invalidPassEl.style.display = "inline";
                passEl.value = "";
                submitPass.disabled = false;
                passEl.disabled = false;
                console.error(e);
                return;
            }
        }
        
        submitPass.onclick = doSubmit;
        passEl.onkeypress = function(e){
            if (!e) e = window.event;
            var keyCode = e.keyCode || e.which;
            invalidPassEl.style.display = "none";
            if (keyCode == '13'){
              // Enter pressed
              doSubmit();
              return false;
            }
        }
    })();
    </script>
  </body>
</html>
